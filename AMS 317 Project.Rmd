---
title: "AMS 317 Linear Regression Project"
author: "Group 3: Hao Yang Lin, Ariadna Sandoya, Arjun Talapatra, Benjamin Novik"
date: "Due Date: November 10, 2024"
output: pdf_document
---
Hypothesis 1: Does **room type** (e.g., private room vs. entire home/apartment) influence the number of **reviews per month**?
Hypothesis 2: Do properties in certain **neighborhoods** receive significantly **more reviews** than others?

```{r}
# Load data and check for missing values
library(readr)
library(dplyr)
library(ggplot2)
library(car)

data <- read_csv("airbnb.csv")

# Summary statistics for variables that are tested for the hypothesis.
summary(data %>% select(room_type, neighbourhood_group, reviews_per_month))
missing_values <- sapply(data, function(x) sum(is.na(x)))
print(missing_values)
```
The resulting output shows us that these following variables have missing values: name, host_name, last_review and reviews_per_month with missing values of 16, 21, 10052 & 10052 respectively. From this, it is shown that the variables, last_review and reviews_per_month are likely correlated. If a listing has no reviews, logically there will not be any reviews for the calculated average. 

```{r}
# Count rows where number_of_reviews is 0 and reviews_per_month is NA
count_na_reviews_per_month <- sum(is.na(data$reviews_per_month) & data$number_of_reviews == 0)

# Count total rows where number_of_reviews is 0
count_zero_reviews <- sum(data$number_of_reviews == 0)

# Check if all rows with number_of_reviews == 0 have reviews_per_month as NA
all_zero_reviews_are_na <- count_na_reviews_per_month == count_zero_reviews
all_zero_reviews_are_na

# Replace NA values in reviews_per_month with 0 where number_of_reviews is 0
data <- data %>%
  mutate(reviews_per_month = ifelse(is.na(reviews_per_month) & 
                                      number_of_reviews == 0, 0, reviews_per_month))


missing_values <- sapply(data, function(x) sum(is.na(x)))
print(missing_values)
```
As observed after the data cleaning process, the majority of variables do not have any missing values anymore aside from last_review, name and host_name. Because these three variables does not pertain any importance to any interest in our analysis, the values can be left as missing.  

# Data Exploration
```{r}
# Summary statistics for room types
data %>%
  group_by(room_type) %>%
  summarise(
    count = n(),
    avg_price = mean(price, na.rm = TRUE),
    avg_reviews_per_month = mean(reviews_per_month, na.rm = TRUE)
  )

summary_stats <- data %>%
  group_by(room_type) %>%
  summarise(
    mean_reviews = mean(reviews_per_month),
    median_reviews = median(reviews_per_month),
    sd_reviews = sd(reviews_per_month)
  )
summary_stats

# Box plot of Reviews per Month by Room type
ggplot(data, aes(x = room_type, y = reviews_per_month)) +
  geom_boxplot(fill = "lightblue", color = "darkblue") +
  labs(title = "Reviews per Month by Room Type",
       x = "Room Type", y = "Reviews per Month") +
  theme_minimal()
# The majority of reviews per month are skewed towards the lower values for all the room types. Moreover, extreme outliers are present, especially for the "private room" type. This indicates a few private rooms recieve far more reviews

# Distribution of room types
ggplot(data, aes(x = room_type)) +
  geom_bar(fill = "lightgreen") +
  labs(title = "Distribution of Room Types",
       x = "Room Type", y = "Count") +
  theme_minimal()
# "Entire home/apartment" is the most common room type, followed by "private room," and "shared room" is the least common.

# Price vs. Reviews per Month
ggplot(data, aes(x = price, y = reviews_per_month)) +
  geom_point(alpha = 0.5, color = "steelblue") +
  labs(title = "Price vs. Reviews per Month",
       x = "Price", y = "Reviews per Month") +
  theme_minimal()
#The relationship between price and reviews is non-linear. There is an inverse relationship betweeen review counts and prices. This suggests affordability encourages more reviews. However, there are outliers that indicate some high-priced properties recieve a higher number of reviews despite this trend. 

# Distribution of prices
ggplot(data, aes(x = price)) +
  geom_histogram(binwidth = 20, fill = "purple", color = "black") +
  labs(title = "Distribution of Prices",
       x = "Price", y = "Frequency") +
  theme_minimal()
#This indicates prices are heavily skewed to the right - most listings are priced at under $1000 with some listings significantly higher. 
```

# Hypothesis 1: ANOVA Test  
Since our dataset is finitely large, over 40000 values, we can assume normality in our data. Thus, performing anova suffices.

```{r}
# ANOVA test for Reviews per Month by Room Type
anova_reviews <- aov(reviews_per_month ~ room_type, data = data)
summary(anova_reviews)
# Our null hypothesis is that The mean number of reviews per month is the same across all room types (private room, entire hom/apt, shared room). Our alternative hypothesis is that at least one room type has a mean number of reviews per month that is significantly different from the others. The Pr(>F) value of 1.79e-10 is significantly smaller than 0.05, meaning we reject the null hypothesis. This indicates at least one room type has a mean significantly different from the others. The F-statistic of 22.45 also indicates a significant differences in the mean number of reviews per month among the three room types.

data <- data %>%
  mutate(log_reviews_per_month = log(reviews_per_month + 0.1))

# Plot the log-transformed data by Room Type
ggplot(data, aes(x = room_type, y = log_reviews_per_month)) +
  geom_boxplot(outlier.colour = "red", outlier.shape = 16, outlier.size = 2) +
  labs(title = "Log-Transformed Reviews per Month by Room Type",
       x = "Room Type", y = "Log of Reviews per Month")
# Since the raw data was not normally distributed, this log transformation was applied to reviews_per_month to reduce the variance and to approximate normality. Although the mean and median seem close across different room types, there is still a visible difference indicating that there is a relationship between room type and reviews.

```

# Check for Normality of Residuals
```{r}
# ANOVA test for Reviews per Month by Room Type
anova_reviews <- aov(log_reviews_per_month ~ room_type, data = data)
summary(anova_reviews)

# Histogram of residuals for visual inspection
hist(residuals(anova_reviews), main = "Histogram of Residuals", xlab = "Residuals", breaks = 30)
#This shows the residuals are not perfectly normal. The histogram appears to be skewed to the right, with a very high frequency at the far left end of the histogram, an approximately symmetric central part, and a typical right-skewing pattern towards the right side of the histogram.

# Kolmogorov-Smirnov Test for normality of residuals 
ks_test <- ks.test(residuals(anova_reviews), 
                   "pnorm", mean = mean(residuals(anova_reviews)), 
                   sd = sd(residuals(anova_reviews)))
print(ks_test)
#The p-value of <2.2e-16 indicates that residuals deviate from a normal distribution.

qqnorm(residuals(anova_reviews))
qqline(residuals(anova_reviews), col = "blue")
```
# Deviations at the tails further confirm residuals are not normally distributed.
We did not use Shapiro-Wilk test for normality because R only allows sample size of 5 to 50000, so we decided to use Kolmogorov-Smirnov Test for normality of residuals.  

# Trimming Data 
```{r}
# Calculate the 45th and 55th percentiles for reviews_per_month
lower_bound <- quantile(data$reviews_per_month, 0.45, na.rm = TRUE)
upper_bound <- quantile(data$reviews_per_month, 0.55, na.rm = TRUE)

# Filter data to include only the middle 80% (10th to 90th percentile)
middle_data <- data %>%
  filter(reviews_per_month >= lower_bound & reviews_per_month <= upper_bound)

# Transformation of the middle quantile
middle_data <- middle_data %>%
  mutate(log_reviews_per_month = log(reviews_per_month + 0.1))

# Fit the ANOVA model on the filtered data
anova_middle <- aov(log_reviews_per_month ~ room_type, data = middle_data)
summary(anova_middle)
# Here, we chose to look at the middle 80 percent of the data to eliminate outliers and improve normality.
# The F-statistic of 3.071 and p-value of 0.0465 indicate that after the transformation, room type still significantly affects reviews_per_month, but less strongly.

# Check assumptions on the middle quantile data
# Q-Q plot for residuals
qqnorm(residuals(anova_middle))
qqline(residuals(anova_middle), col = "blue")
#The points in the middle appear align closely with the line, while points at the tails show more deviation. This indicates that while the central part of the residuals is approximately normal, the extreme values still show skewness. 
# Histogram of residuals
hist(residuals(anova_middle), main = "Histogram of Residuals", xlab = "Residuals", breaks = 30)
# This is approximately symmetric centered at around 0.0. There is less skewness compared to the untrimmed data. This relatively uniform distribution suggests that using ANOVA is useful after the transformation.

# Shapiro-Wilk test for normality for the middle 45%-55% quantile
shapiro_test_middle <- shapiro.test(residuals(anova_middle))
print(shapiro_test_middle)
# Indicates that residuals still aren't perfectly normally distributed b/c p-value is <2.2e-16.

# Levene's test for homogeneity of variances
levene_test_middle <- leveneTest(log_reviews_per_month ~ room_type, data = middle_data)
print(levene_test_middle)
# p = 0.8321 indicates homogeneity of variances, which supports the use of ANOVA despite not satisfying normality of residuals.

```
Overall Analysis for Hypothesis 1: ANOVA Test: ANOVA shows there is significant association between room type and reviews per month, which remains after the data cleaning, although at a weaker strength. The F-statistic and p-values from ANOVA confirm that at least one room type has a mean number of reviews that significantly differs from the rest. Despite having residuals deviate from normality, even after the transformations. Levene’s Test supports the use of ANOVA. 


# Hypothesis 2: Borough Influence on Reviews per Month
```{r}
# Summary Statistucs of Borough
data %>%
  group_by(neighbourhood_group) %>%
  summarise(
    count = n(),
    avg_reviews_per_month = mean(reviews_per_month, na.rm = TRUE),
    median_reviews_per_month = median(reviews_per_month, na.rm = TRUE)
  )
#  Review per Month by Neighborhood Group
ggplot(data, aes(x = neighbourhood_group, y = reviews_per_month)) +
  geom_boxplot() +
  labs(title = "Reviews per Month by Neighborhood Group", x = "Neighborhood Group", y = "Reviews per Month")

# Kruskal-Wallis test for Reviews per Month by Neighborhood Group
kruskal_test <- kruskal.test(reviews_per_month ~ neighbourhood_group, data = data)
kruskal_test
```
Since KW test is signficant, we can perform a Dunn’s test to pinpoint which specific neighborhood groups differ from each other in terms of reviews_per_month.

```{r}
library(FSA)
# Post-hoc Dunn's test with Bonferroni correction
dunn_test <- dunnTest(reviews_per_month ~ neighbourhood_group, data = data, method = "bonferroni")
print(dunn_test)
```
The Kruskal-Wallis test combined with Dunn’s post-hoc analysis, indicates that review frequency varies significantly across most neighborhood groups.

